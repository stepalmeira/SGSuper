CREATE TABLE Produto (
	cod_barras VARCHAR(13) PRIMARY KEY,
	nome VARCHAR(255) NOT NULL,
	tipo_produto VARCHAR(255) NOT NULL,
	preco_venda DECIMAL(10, 2) NOT NULL,
	estoque_minimo INT
);

CREATE TABLE Fornecedor (
	cod_fornecedor SERIAL PRIMARY KEY,
	nome_fornecedor VARCHAR(255) NOT NULL,
	data_contratacao DATE NOT NULL
);

CREATE TABLE Lote(
	cod_lote SERIAL PRIMARY KEY,
	quantidade INT NOT NULL,
	cod_fornecedor INT NOT NULL,
	cod_produto VARCHAR(13),
	preco_compra DECIMAL(10, 2) NOT NULL,
	data_recebimento DATE NOT NULL,
	data_validade DATE NOT NULL,
	FOREIGN KEY (cod_produto) REFERENCES Produto(cod_barras),
	FOREIGN KEY (cod_fornecedor) REFERENCES Fornecedor(cod_fornecedor)
);

CREATE TABLE Setor(
	cod_setor SERIAL PRIMARY KEY,
	nome_setor VARCHAR(255) NOT NULL,
	--FOREIGN KEY (cpf_gerente) REFERENCES Funcionário(cpf) adicionar dps pq funcionário referencia setor
);

CREATE TABLE Venda(
	cod_venda SERIAL PRIMARY KEY,
	data_venda DATE NOT NULL,
	--FOREIGN KEY (cpf_funcionario) REFERENCES Funcionario(cpf),
	valor_total DECIMAL (10, 2) NOT NULL,
	forma_pagamento VARCHAR(20) NOT NULL,
	qntd_parcelas INT,
	valor_desconto DECIMAL (10, 2)
);

CREATE TABLE Funcionario(
	cpf CHAR(11) PRIMARY KEY,
	nome_completo VARCHAR(255) NOT NULL,
	cod_setor INT NOT NULL,
	cargo VARCHAR(50) NOT NULL,
	genero VARCHAR(20),
	endereco VARCHAR(255),
	salario DECIMAL(10, 2) NOT NULL,
	FOREIGN KEY (cod_setor) REFERENCES Setor(cod_setor)
);

CREATE TABLE Acougueiro (
	cpf CHAR(11) PRIMARY KEY REFERENCES funcionario(cpf),
	certificacao VARCHAR(100),
	epi_entregue BOOLEAN
);

CREATE TABLE Padeiro (
	cpf CHAR(11) PRIMARY KEY REFERENCES funcionario(cpf),
	certificacao VARCHAR(100),
	epi_entregue BOOLEAN
);

CREATE TABLE Analista_financeiro (
	cpf CHAR(11) PRIMARY KEY REFERENCES funcionario(cpf),
	certificacao VARCHAR(100)
);

CREATE TABLE Operador (
	cpf CHAR(11) PRIMARY KEY REFERENCES funcionario(cpf),
	posto_pdv VARCHAR(50)
);

CREATE TABLE Venda_Contem_Produto (
    cod_venda INT REFERENCES Venda(cod_venda),
    cod_barras VARCHAR(13) REFERENCES Produto(cod_barras),
    quantidade INT NOT NULL,
    PRIMARY KEY (cod_venda, cod_barras)
);

ALTER TABLE Setor
	ADD COLUMN cpf_gerente CHAR(11);
ALTER TABLE Setor
	ADD CONSTRAINT fk_gerente FOREIGN KEY (cpf_gerente) REFERENCES Funcionario(cpf);

ALTER TABLE Venda
	ADD COLUMN cpf_funcionario CHAR(11);
ALTER TABLE Venda
	ADD CONSTRAINT fk_funcionario_venda FOREIGN KEY (cpf_funcionario) REFERENCES Funcionario(cpf);



